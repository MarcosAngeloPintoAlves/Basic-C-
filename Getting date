using System;
using System.Collections.Generic;
using System.Data;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Trabalho_4BimestreLP1TB 
{
    public class CGastosData //class
    {
        public DateTime data1 { get; private set; } 
        public DateTime data2 { get; private set; }

        public void setData1(DateTime dt1)
        {
            data1 = dt1;
        }
        public void setData2(DateTime dt2)
        {
            data2 = dt2;
        }

        public DataTable busca(DateTime data1, DateTime data2) //method who get a value between two different dates
        {
            CBanco BB; //connection DB class
            try
            {
                BB = new CBanco();
                if ((this.data1.Date != null) || (this.data2.Date != null)) //if the date is not empty
                {
                    BB.comando.CommandText = "Select valor,descr from despesa where data >= @dt1 and data <= @dt2"; //get a value
                    BB.comando.Parameters.Add("@dt1", NpgsqlTypes.NpgsqlDbType.Date).Value = data1; //by paremeters
                    BB.comando.Parameters.Add("@dt2", NpgsqlTypes.NpgsqlDbType.Date).Value = data2;
                }
                else
                {
                    BB.comando.CommandText = "Select descr,valor from despesa"; //get all values
                }
                BB.comando.Prepare();
                BB.dreader = BB.comando.ExecuteReader();
                BB.tabela = new DataTable(); //creating a new DataTable
                BB.tabela.Load(BB.dreader);
                return (BB.tabela); //return the values of the Query in DataTable format
            }
            catch (Exception ex)
            {
                throw new Exception("Query error:" + ex.Message);
            }
        }
      }
  }
